<fieldset>
	<legend><?= __('Users')?></legend>

	<!-- search and some actions -->
	<div class="row bottom-buffer">
		<div class="col-sm-2">
			<?= $this->Html->link(
					$this->Html->tag('span', "", [
						'class' => "glyphicon glyphicon-plus",
						'aria-hidden' => "true",
						'title' => __("Add new user"),
					]),
				['controller' => 'users', 'action' => 'add'],
				['escape' => false])
			?>
			<?= $this->Html->link(
						$this->Html->tag('span', "", [
							'class' => "glyphicon glyphicon-export",
							'aria-hidden' => "true",
							'title' => __("Export users to CSV"),
						]),
						['action' => 'export'],
						['escape' => false]
					)
			?>
			<?= $this->Html->link(
						$this->Html->tag('span', "", [
							'class' => "glyphicon glyphicon-import",
							'aria-hidden' => "true",
							'title' => __("Import users from CSV"),
						]),
						['action' => 'import'],
						['escape' => false]
					)
			?>
		</div>
		<?= $this->Form->create('search', array('type'=>'get')) ?>
		<div class="col-sm-1 col-sm-offset-4">
			<div class="input-group stylish-input-group">
				<?= $this->Form->input('results', [
						'type' => 'select',
						'label' => false,
						'class' => "form-control",
						'title' => __('Results/page'),
						'options' => ['25' => '25', '50' => '50', '100' => '100', '500' => '500', '1000' => '1000'],
						'value' => '25',
					]);
				?>
			</div>
		</div>
		<div class="col-sm-5">
			<div id="imaginary_container"> 
				<div class="input-group stylish-input-group">
					<?= $this->Form->input('query', [
							'type' => 'text',
							'label' => false,
							'value' => $search_query,
							'class' => "form-control",
							'placeholder' => __("Search"),
						]);
					?>
					<?= $this->Form->input('action', [
							'type' => 'hidden',
							'value' => 'search'])
					?>
					<span class="input-group-addon">
						<?= $this->Form->button(
								$this->Html->tag('span', '', [
									'class' => "glyphicon glyphicon-search",
									'aria-hidden' => "true",
									'title' => __("Search"),
							]));
						?>
					</span>
				</div>
			</div>
		</div>
		<?= $this->Form->end() ?>
	</div>

	<?= $this->Form->create('action', [ 
			'class' => 'form-horizontal',
			'onsubmit' => "return confirm(\"".__('Confirm action ?')."\");"
		])
	?>

	<table class="table table-striped">
		<tr>
			<th><input type="checkbox" id="select_all"/></th>
			<th><?= $this->Paginator->sort('displayname', __('Display name')) ?></th>
			<th><?= $this->Paginator->sort('username', __('Login')) ?></th>
			<th><?= $this->Paginator->sort('profile_id', __('Profile')) ?></th>
			<th><?= $this->Paginator->sort('enabled', __('Enabled')) ?></th>
			<th><?= $this->Paginator->sort('admin', __('Admin')) ?></th>
			<th class="actions"><?= __('Actions') ?></th>
		</tr>
		
		<?php foreach ($users as $user): ?>
		<tr>
			<td>
				<?php if($user->id != 1): ?>
					<input class="checkbox" type="checkbox" name="check[]" value="<?= $user->id ?>">
				<?php endif ?>
			</td>
			<td><?= h($user->displayname) ?></td>
			<td>
				<?= $this->Html->link($user->username, ['action' => 'edit', $user->id]) ?>
			</td>
			<td>
				<?= $this->Html->link($user->profile->profilename, ['controller' => 'profiles', 'action' => 'edit', $user->profile->id]) ?>
			</td>
			<td>
				<?= h($user->enabled) ? 
						$this->Html->tag('span', "", [
							'class' => "glyphicon glyphicon-ok",
							'aria-hidden' => "true",
							'title' => __("Yes"),
						]) : 
						$this->Html->tag('span', "", [
							'class' => "none",
							'aria-hidden' => "true",
							'title' => __("No"),
						])
				?>
			</td>
		
			<td>
				<?= h($user->admin) ? 
						$this->Html->tag('span', "", [
							'class' => "glyphicon glyphicon-ok",
							'aria-hidden' => "true",
							'title' => __("Yes"),
					]) : 
					$this->Html->tag('span', "", [
							'class' => "none",
							'aria-hidden' => "true",
							'title' => __("No"),
					])
				?>
			</td>
			<td>
				<?= $this->Html->link(
						$this->Html->tag('span', "", [
						'class' => "glyphicon glyphicon-edit",
						'aria-hidden' => "true",
						'title' => __("Edit"),
							]),
					['controller' => 'users', 'action' => 'edit', $user->id],
					['escape' => false]
				)
				?>
				<?php
					if($user->id != 1 ) {
					echo $this->Form->postLink(
						$this->Html->tag('span', "", [
						'class' => "glyphicon glyphicon-trash",
						'aria-hidden' => "true",
						'title' => __("Delete"),
							]),
					['action' => 'delete', $user->id],
					['escape' => false, 'block' => true, 'confirm' => __('Are you sure to delete {0} ?', h($user->username))]
					);
				}
				?>
			</td>
		</tr>
		<?php endforeach; ?>
	</table>

	<div class="row">
		<div class="col-lg-2">
				<?= $this->Form->input('action', [
						'type' => 'select',
						'label' => false,
						'options' => [
							'disable' => __('Disable') ,
							'enable' => __('Enable'), 
							'setprofile' => __('change profile'), 
							'delete' => __('Delete')
							],
						'empty' => __('(select action)'),
						'id' => "action",
						'class' => "form-control",
						'required' => "required",
					]);
				?>
		</div>
		<div id="setprofile" class="dynform" style="display:none">
			<div class="col-lg-2" name="select-profile">
				<?= $this->Form->input('profile_id', [
						'type' => 'select',
						'label' => false,
						'options' => $profiles,
						'empty' => __('(select profile)'),
						'id' => "inputProfile",
						'class' => "form-control",
					]);
				?>
			</div>
		</div>
		<div class="col-lg-1">
			<?= $this->Form->button(
					$this->Html->tag('span', '', [
						'class' => "glyphicon glyphicon-ok",
						'aria-hidden' => "true",
						'title' => __("Go"),
						])."&nbsp".__('Go'),
					[ 'class' => "btn btn-default pull-right", 'escape' => false]) 
			?>
		</div>
	</div>

	<?= $this->Form->end() ?>
	<?= $this->fetch('postLink') ?>

	<div class="paginator">
		<ul class="pagination">
			<?= $this->Paginator->prev('< ' . __('previous')) ?>
			<?= $this->Paginator->numbers() ?>
			<?= $this->Paginator->next(__('next') . ' >') ?>
		</ul>
		<p><?= $this->Paginator->counter() ?></p>
	</div>
</fieldset>

<script src="/js/selectall.js"></script>
<script>
	$(document).ready(function() {
		$('#' + $("#action").val()).show();
		$('select#action').change(function() {
				$('.dynform').hide();
			$('#' + $(this).val()).show();
			});
	});
</script>
